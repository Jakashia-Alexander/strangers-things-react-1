(this["webpackJsonpstrangers-things-react"]=this["webpackJsonpstrangers-things-react"]||[]).push([[0],{17:function(e,t,n){"use strict";n.r(t);var r=n(9),s=n(7),c=n(2),a=n(0),o=n(1),i=n(10),l=n.n(i),u=n(3),j=n.n(u),b=n(4),d="https://strangers-things.herokuapp.com/api/2007-LSU-RM-WEB-PT",p=function(){return localStorage.getItem("auth-token")},h=function(e){localStorage.setItem("auth-token",e)};function O(){var e={"Content-Type":"application/json"};return p()&&(e.Authorization="Bearer ".concat(p())),e}var x=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,s,c,a,o,i,l=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],s="".concat(d,"/users")+(r?"/register":"/login"),e.next=4,fetch(s,{method:"POST",headers:O(),body:JSON.stringify({user:{username:t,password:n}})});case 4:return c=e.sent,e.next=7,c.json();case 7:if(a=e.sent,o=a.error,i=a.data,!o){e.next=12;break}throw Error(o.message);case 12:return i&&i.token&&h(i.token),e.abrupt("return",i);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var s,c,a,o,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:t,headers:O()},r&&(s.body=JSON.stringify(r)),e.next=4,fetch("".concat(d).concat(n),s);case 4:return c=e.sent,e.next=7,c.json();case 7:if(a=e.sent,o=a.error,i=a.data,!o){e.next=12;break}throw Error(o.message);case 12:return i&&i.token&&h(i.token),e.abrupt("return",i);case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),g=function(e){var t=e.setIsLoggedIn,n=Object(o.useState)(""),r=Object(c.a)(n,2),s=r[0],i=r[1],l=Object(o.useState)(""),u=Object(c.a)(l,2),d=u[0],p=u[1],h=Object(o.useState)(null),O=Object(c.a)(h,2),f=O[0],g=O[1];return Object(a.jsxs)("form",{className:"auth",onSubmit:function(e){return e.preventDefault()},children:[Object(a.jsx)("h3",{children:"Register or Log In"}),f?Object(a.jsx)("h5",{className:"error",children:f}):null,Object(a.jsx)("input",{type:"text",value:s,onChange:function(e){return i(e.target.value)},placeholder:"username",className:"login"}),Object(a.jsx)("input",{type:"password",value:d,onChange:function(e){return p(e.target.value)},placeholder:"password",className:"login"}),Object(a.jsx)("button",{onClick:function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x(s,d,!0);case 3:e.sent,t(!0),window.location.reload(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),children:"Register"}),Object(a.jsx)("button",{onClick:function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x(s,d);case 3:e.sent,t(!0),window.location.reload(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),children:"Log In"})]})},m=function(){return Object(a.jsx)("header",{id:"title",className:"header",children:Object(a.jsx)("h1",{className:"pageName",children:"Stranger's Things"})})},v=function(e){var t=e.postList,n=e.filterTerm,r=e.setPostList,s=Object(o.useState)(!!p()),i=Object(c.a)(s,2),l=i[0],u=(i[1],e.postList,e.setEditablePost);return Object(a.jsx)("div",{className:"posts",children:t.filter((function(e){return e.title.toLowerCase().includes(n.toLowerCase())||e.description.toLowerCase().includes(n.toLowerCase())})).reverse().map((function(e,t){return console.log("Post:",t,e.willDeliver),Object(a.jsxs)("div",{className:"post",style:{border:e.isAuthor?"5px solid gold":"1px solid brown"},children:[Object(a.jsx)("h5",{className:"post-title",children:e.title}),Object(a.jsx)("h4",{className:"post-location",children:e.location}),Object(a.jsxs)("p",{children:[Object(a.jsx)("strong",{children:"Posted by:"})," ",e.author.username]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("strong",{children:"Description:"}),e.description]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("strong",{children:"Price:"})," ",e.price]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("strong",{children:"Posted on:"}),e.createdAt]}),Object(a.jsx)("p",{children:e.willDeliver}),e.isAuthor?Object(a.jsx)("button",{className:"edit",onClick:function(){u(e)},children:"EDIT"}):null,!e.isAuthor&&l?Object(a.jsx)(k,{postId:e._id}):null,e.isAuthor&&l?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("button",{className:"deletePost",onClick:Object(b.a)(j.a.mark((function t(){var n,s;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("DELETE","/posts/"+e._id);case 2:return t.next=4,f("GET","/posts");case 4:n=t.sent,s=n.posts,r(s);case 7:case"end":return t.stop()}}),t)}))),children:"DELETE"})," "]}):null,e.isAuthor&&l?Object(a.jsxs)("div",{className:"messageInbox",children:[Object(a.jsx)("h3",{children:"Messages Received About This Item:"}),e.messages.map((function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)("p",{children:[e.fromUser.username,": ",e.content]})})}))]}):null]},t)}))})},w=function(e){var t=e.filterTerm,n=e.setFilterTerm;return Object(a.jsxs)("form",{id:"search",className:"search",onSubmit:function(e){e.preventDefault()},children:[Object(a.jsxs)("label",{htmlFor:"keywords",children:[" ",Object(a.jsx)("strong",{children:"SEARCH"})]}),Object(a.jsx)("input",{id:"keywords",type:"text",placeholder:"Enter Keywords for Search",className:"search",value:t,onChange:function(e){n(e.target.value)}}),Object(a.jsx)("button",{onClick:function(){return n("")},children:"RESET FILTER"})]})},S=function(e){var t=e.addNewPost,n=e._id,r=e.setEditablePost,s=e.updatePost,i=Object(o.useState)(""),l=Object(c.a)(i,2),u=l[0],d=l[1],p=Object(o.useState)(""),h=Object(c.a)(p,2),O=h[0],x=h[1],g=Object(o.useState)(""),m=Object(c.a)(g,2),v=m[0],w=m[1],S=Object(o.useState)(""),k=Object(c.a)(S,2),y=k[0],E=k[1],N=Object(o.useState)(!1),T=Object(c.a)(N,2),C=T[0],P=T[1];Object(o.useEffect)((function(){d(e.title||""),x(e.description||""),w(e.price||""),E(e.location||""),P(e.willDeliver||!1)}),[n]);var I=Object(o.useState)(!1),L=Object(c.a)(I,2),D=L[0],A=L[1];return Object(a.jsxs)("form",{className:"post-form",onSubmit:function(){var c=Object(b.a)(j.a.mark((function c(a){var o,i,l,b;return j.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(a.preventDefault(),0!==u.length&&0!==O.length&&0!==v.length){c.next=4;break}return A(!0),c.abrupt("return");case 4:if(o={post:{title:u,description:O,price:v,willDeliver:C}},y.length>0&&(o.post.location=y),c.prev=6,!n){c.next=17;break}return c.next=10,f("PATCH","/posts/".concat(n),o);case 10:i=c.sent,(l=i.post).messages=e.messages,s(l),r({}),c.next=22;break;case 17:return c.next=19,f("POST","/posts",o);case 19:b=c.sent,t(b.post),d(""),x(""),w(""),E(""),P(!1);case 22:c.next=27;break;case 24:c.prev=24,c.t0=c.catch(6),console.error(c.t0);case 27:case"end":return c.stop()}}),c,null,[[6,24]])})));return function(e){return c.apply(this,arguments)}}(),style:{alignSelf:"flex-start",display:"grid",gridTemplateColumns:"1fr",maxWidth:"480px",gap:"8px",fontsize:"30px"},children:[n?Object(a.jsx)("h3",{children:"Update Your Post"}):Object(a.jsx)("h3",{children:"Whatcha got?"}),Object(a.jsx)("input",{type:"text",placeholder:"title for your post",value:u,onChange:function(e){return d(e.target.value)}}),D&&0===u.length?Object(a.jsx)("h3",{style:{color:"red"},children:"You need a title"}):null,Object(a.jsx)("textarea",{type:"text",placeholder:"description of the item",rows:"10",columns:"80",value:O,onChange:function(e){return x(e.target.value)}}),Object(a.jsx)("input",{type:"text",placeholder:"requested price",value:v,onChange:function(e){return w(e.target.value)}}),Object(a.jsx)("input",{type:"text",placeholder:"location, leave blank for [On Request]",value:y,onChange:function(e){return E(e.target.value)}}),Object(a.jsxs)("label",{children:[Object(a.jsx)("input",{className:"checkbox",type:"checkbox",checked:C,onChange:function(){return P(!C)}}),"I will deliver this"]}),Object(a.jsx)("button",{children:"POST IT"})]})},k=function(e){var t=Object(o.useState)(""),n=Object(c.a)(t,2),r=n[0],s=n[1],i=e.postId;return Object(a.jsxs)("form",{className:"messages",style:{alignSelf:"flex-start",display:"grid",gridTemplateColumns:"1fr",maxWidth:"480px",gap:"8px"},children:[Object(a.jsx)("h3",{children:"Interested? Send a message to the seller."}),Object(a.jsx)("textarea",{type:"text",placeholder:"message content",rows:"10",columns:"80",value:r,onChange:function(e){return s(e.target.value)}}),Object(a.jsxs)("button",{onClick:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={message:{content:r}},e.prev=2,e.next=5,f("POST","/posts/"+i+"/messages",n);case 5:s(""),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),children:[" ","SEND MESSAGE"]})]})},y=function(){var e=Object(o.useState)(!!p()),t=Object(c.a)(e,2),n=t[0],i=t[1],l=Object(o.useState)([]),u=Object(c.a)(l,2),j=u[0],b=u[1],d=Object(o.useState)(""),h=Object(c.a)(d,2),O=h[0],x=h[1],k=Object(o.useState)([]),y=Object(c.a)(k,2),E=(y[0],y[1],Object(o.useState)(!1)),N=Object(c.a)(E,2),T=(N[0],N[1],Object(o.useState)([])),C=Object(c.a)(T,2),P=(C[0],C[1]),I=Object(o.useState)({}),L=Object(c.a)(I,2),D=L[0],A=L[1];return Object(o.useEffect)((function(){f("GET","/posts").then((function(e){var t=e.posts;b(t)})).catch(console.error)}),[n]),Object(o.useEffect)((function(){n?f("get","/users/me").then((function(e){var t=e.messages;P(t)})).catch(console.error):P([])}),[n]),Object(a.jsxs)("div",{className:"app",children:[Object(a.jsx)(m,{}),Object(a.jsx)(w,{filterTerm:O,setFilterTerm:x}),Object(a.jsx)(v,{postList:j,setPostList:b,filterTerm:O,setEditablePost:A}),n?Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)("div",{className:"logout",children:[Object(a.jsx)("h1",{className:"loginMessage",children:"Thanks for logging in!"}),Object(a.jsx)("span",{children:Object(a.jsx)("button",{className:"logoutButton",onClick:function(){localStorage.removeItem("auth-token"),i(!1),window.location.reload(!1)},children:"LOG OUT"})})]})}):Object(a.jsx)(g,{setIsLoggedIn:i}),n?Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(S,Object(r.a)(Object(r.a)({addNewPost:function(e){b([].concat(Object(s.a)(j),[e]))},updatePost:function(e){var t=j.findIndex((function(t){return t._id===e._id}));if(t>-1){var n=Object(s.a)(j);n[t]=e,b(n)}}},D),{},{setEditablePost:A}))}):null]})};l.a.render(Object(a.jsx)(y,{}),document.getElementById("app"))}},[[17,1,2]]]);
//# sourceMappingURL=main.7242e731.chunk.js.map